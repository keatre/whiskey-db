# --- Core service config ---
APP_NAME=Whiskey DB
NEXT_PUBLIC_APP_NAME=Whiskey DB
API_HOST=0.0.0.0
API_PORT=8000
API_BASE=http://api:8000
TZ=America/Chicago

# --- Database ---
DATABASE_URL=sqlite:////data/whiskey.db

# --- CORS / Frontend ---
ALLOWED_ORIGINS=http://192.168.0.100:8080,http://localhost:8080,http://127.0.0.1:8080,https://whiskey-db.example
NEXT_PUBLIC_API_BASE=/api
# Used by server-side rewrites inside the web image
NEXT_BACKEND_ORIGIN=http://api:8000
# --- Security / JWT ---
SECRET_KEY="change-me-please"   # strong random string (quoted so special chars work)
ACCESS_TOKEN_EXPIRE_MINUTES=20
NEXT_PUBLIC_SESSION_IDLE_MINUTES=
REFRESH_TOKEN_EXPIRE_DAYS=30
JWT_COOKIE_NAME=access_token
JWT_REFRESH_COOKIE_NAME=refresh_token
COOKIE_SAMESITE=lax
COOKIE_SECURE=auto
# COOKIE_DOMAIN=   # leave unset to bind cookie to current host

# --- LAN guest access ---
ALLOW_LAN_GUEST=true
# Include proxies that terminate TLS for you (Cloudflare Tunnel runs on 127.0.0.1)
TRUSTED_PROXIES=127.0.0.1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
LAN_GUEST_HOSTS=localhost,127.0.0.1

# External protection from DDoS attacks
LOGIN_WINDOW_SECONDS=60
LOGIN_MAX_ATTEMPTS=10
LOGIN_LOCKOUT_SECONDS=180

# --- Market Price Providers ---
# MARKET_PRICE_PROVIDER_URL=https://prices.example.com/v1/whisky?upc={upc}
# MARKET_PRICE_PROVIDER_API_KEY=your-api-key
# MARKET_PRICE_PROVIDER_NAME=ExampleWhiskyAPI
# MARKET_PRICE_PROVIDER_TIMEOUT_SECONDS=8

# --- Logging ---
LOG_LEVEL=info
LOG_FILE_PATH=/logs/whiskey_db.log
LOG_MAX_MB=10
LOG_RETENTION_DAYS=14

# Container runtime user (optional; uncomment if you want containers running as host UID/GID)
# PUID=1000
# PGID=1000

# --- Uploads ---
UPLOAD_MAX_MB=100
UPLOAD_DIR=/data/uploads
IMAGE_URL_MIGRATE_ON_START=true

# --- Admin bootstrap (one-time) ---
ADMIN_USERNAME=admin
ADMIN_PASSWORD=please-change-me
ADMIN_EMAIL=

# --- When deploying behind HTTPS (uncomment & set) ---
# ALLOWED_ORIGINS=https://your-web-origin.example
# NEXT_PUBLIC_API_BASE=https://api.your-domain.example
# COOKIE_SECURE=true

# ================================
# Backups (Restic) â†’ NAS via SMB
# ================================
BACKUP_ENABLED=true
BACKUP_SOURCE=/data # Source path to back up (bind mounted by compose)

# Directory for plaintext archives when BACKUP_ENCRYPTED=false
BACKUP_ARCHIVE_DIR=/remote/whiskey-db-plain
PLAINTEXT_RETENTION_DAYS=30

# Encrypted restic repository settings
BACKUP_ENCRYPTED=true
BACKUP_REPOSITORY=/remote/restic-whiskey-db
RESTIC_PASSWORD=change-me-strong
RESTIC_KEEP_DAILY=7
RESTIC_KEEP_WEEKLY=4
RESTIC_KEEP_MONTHLY=12

# Cron schedule for backups (default: 3:00 AM daily)
BACKUP_CRON=0 3 * * *

# Optional tag for snapshots
BACKUP_TAG=whiskey-db

# Run a smoke-test backup immediately when the container starts (logs to /var/log/backup.log)
BACKUP_ON_START=false

# Include docker-compose.yml and .env in backups (when files are mounted)
BACKUP_LOCAL_FILES=false
